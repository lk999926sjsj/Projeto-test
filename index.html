<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Site Personalizável</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Variáveis globais fornecidas pelo ambiente Canvas (MANDATÓRIO)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Exporta para ser acessível no escopo global do script principal
        window.firebaseApp = app;
        window.firebaseDb = db;
        window.firebaseAuth = auth;
        window.initialAuthToken = initialAuthToken;
        window.currentAppId = appId;
        window.onAuthStateChanged = onAuthStateChanged; // Expor para uso no script principal
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signOut = signOut;
        window.doc = doc;
        window.getDoc = getDoc;
        window.setDoc = setDoc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.onSnapshot = onSnapshot;
        window.collection = collection;
        window.query = query;
        window.where = where;
        window.addDoc = addDoc;
        window.getDocs = getDocs;
        window.signInAnonymously = signInAnonymously;
        window.signInWithCustomToken = signInWithCustomToken;
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para a fonte Inter e para garantir que o corpo ocupe toda a altura */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh; /* Garante que o corpo ocupe a altura total da viewport */
            display: flex; /* Permite centralizar o conteúdo verticalmente */
            justify-content: center; /* Centraliza o conteúdo horizontalmente */
            align-items: center; /* Centraliza o conteúdo verticalmente */
            background-color: #f0f4f8; /* Cor de fundo suave (fallback) */
            overflow: hidden; /* Evita barras de rolagem */
            position: relative; /* Necessário para posicionar o conteúdo */
            /* --- PONTO DE ALTERAÇÃO: PAPEL DE PAREDE DE IMAGEM --- */
            background-image: url('https://backiee.com/static/wallpapers/560x315/411581.jpg'); /* URL da sua imagem de fundo */
            background-size: cover; /* Faz a imagem cobrir toda a área */
            background-position: center; /* Centraliza a imagem */
            background-repeat: no-repeat; /* Evita que a imagem se repita */
            background-attachment: fixed; /* Mantém a imagem fixa ao rolar a página */
        }

        /* Estilo para a caixa de mensagem personalizada */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4CAF50; /* Verde para sucesso */
            color: white; /* Alterado para branco para melhor contraste */
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none; /* Escondido por padrão */
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .message-box.error {
            background-color: #f44336; /* Vermelho para erro */
        }
        .message-box.show {
            display: block;
            opacity: 1;
        }
        
        /* Estilo para o painel de login transparente */
        #loginPanel {
            background-color: transparent; /* Fundo totalmente transparente */
            box-shadow: none; /* Removendo a sombra para um visual mais limpo e transparente */
            z-index: 1; /* Garante que o painel fique acima do fundo */
            position: relative; /* Necessário para z-index funcionar corretamente */
        }
        /* Estilo para o botão de login transparente */
        #loginButton {
            background-color: transparent; /* Fundo transparente */
            border: 2px solid white; /* Borda branca para visibilidade */
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        /* Estilo de hover para o botão transparente */
        #loginButton:hover {
            background-color: rgba(255, 255, 255, 0.2); /* Fundo branco semi-transparente no hover */
            transform: scale(1.05); /* Mantém o efeito de escala no hover */
        }

        /* Estilos para os modais */
        .photo-gallery-modal, .code-modal, .video-gallery-modal, .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Fundo escuro semi-transparente */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001; /* Acima de tudo */
            backdrop-filter: blur(5px); /* Efeito de desfoque */
        }

        .photo-gallery-content, .code-modal-content, .video-gallery-content, .admin-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto; /* Permite rolagem se o conteúdo for muito grande */
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .photo-gallery-close, .code-modal-close, .video-gallery-close, .admin-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 2rem;
            color: #333;
            cursor: pointer;
            transition: color 0.2s;
        }

        .photo-gallery-close:hover, .code-modal-close:hover, .video-gallery-close:hover, .admin-modal-close:hover {
            color: #f44336;
        }

        .photo-thumbnail, .video-thumbnail {
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }

        .photo-thumbnail:hover, .video-thumbnail:hover {
            border-color: #3b82f6; /* Cor de destaque no hover */
        }

        .main-photo-display, .main-video-display {
            margin-top: 1.5rem;
            max-width: 100%;
            max-height: 500px; /* Altura máxima para a imagem/vídeo principal */
            object-fit: contain; /* Garante que o conteúdo se ajuste */
        }

        .gallery-navigation button {
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s, transform 0.2s;
        }

        .gallery-navigation button:hover {
            background-color: #2563eb;
            transform: scale(1.05);
        }

        /* Estilos para a área de código */
        #codeDisplay {
            width: 100%;
            height: 200px;
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            resize: vertical; /* Permite redimensionar verticalmente */
            margin-bottom: 1rem;
        }

        #copyCodeButton {
            background-color: #28a745; /* Cor verde para copiar */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s, transform 0.2s;
        }

        #copyCodeButton:hover {
            background-color: #218838;
            transform: scale(1.05);
        }

        /* Estilos para o campo de pesquisa de fotos/vídeos */
        .photo-search-container, .video-search-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            width: 100%;
            max-width: 400px; /* Limita a largura do campo de pesquisa */
        }

        .photo-search-container input, .video-search-container input {
            flex-grow: 1;
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
        }

        .photo-search-container button, .video-search-container button {
            background-color: #1e90ff; /* Azul para o botão de pesquisa */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s, transform 0.2s;
        }

        .photo-search-container button:hover, .video-search-container button:hover {
            background-color: #007bff;
            transform: scale(1.05);
        }

        /* Estilos para o painel de administração */
        #adminPanelDashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        #adminPanelDashboard h4 {
            font-weight: bold;
            margin-bottom: 0.75rem;
            color: #333;
        }

        #userListTable th, #userListTable td {
            padding: 0.5rem;
            border: 1px solid #eee;
            text-align: left;
        }

        #userListTable th {
            background-color: #f0f0f0;
        }

        #userListTable button {
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            color: white;
            transition: background-color 0.2s;
        }
        #userListTable button.blacklist { background-color: #ffc107; }
        #userListTable button.blacklist:hover { background-color: #e0a800; }
        #userListTable button.remove { background-color: #dc3545; }
        #userListTable button.remove:hover { background-color: #c82333; }
        #userListTable button.unblacklist { background-color: #17a2b8; }
        #userListTable button.unblacklist:hover { background-color: #138496; }

        .admin-section {
            background-color: #f9f9f9;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .admin-section input[type="text"],
        .admin-section input[type="password"],
        .admin-section input[type="number"],
        .admin-section select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        .admin-section button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.2s;
        }
        .admin-section button.create { background-color: #007bff; }
        .admin-section button.create:hover { background-color: #0056b3; transform: scale(1.02); }
        .admin-section button.toggle { background-color: #6c757d; }
        .admin-section button.toggle:hover { background-color: #5a6268; transform: scale(1.02); }
        .admin-section button.apply { background-color: #28a745; }
        .admin-section button.apply:hover { background-color: #218838; transform: scale(1.02); }

        .admin-section .flex-row-center {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div id="messageBox" class="message-box rounded-lg"></div>

    <div id="maintenanceOverlay" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center text-white text-3xl font-bold z-[1002] hidden">
        <p>Site em Manutenção. Voltaremos em breve!</p>
    </div>

    <div id="loginPanel" class="p-8 rounded-xl w-full max-w-md text-center">
        <h2 class="text-3xl font-bold mb-6 text-white">logue com sua conta</h2>
        <div class="mb-4">
            <input type="text" id="username" placeholder="Usuário (Email)" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 bg-gray-700 text-white placeholder-gray-400">
        </div>
        <div class="mb-6">
            <input type="password" id="password" placeholder="Senha" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 bg-gray-700 text-white placeholder-gray-400">
        </div>
        <button id="loginButton" class="w-full text-white py-3 rounded-lg shadow-md">Entrar</button>
    </div>

    <div id="dashboardPanel" class="bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl text-center hidden">
        <h2 class="text-3xl font-bold mb-8 text-gray-800">Bem-vindo(a) ao seu Painel!</h2>
        <p class="text-lg text-gray-600 mb-8">Escolha uma função abaixo:</p>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <button id="function1Button" class="bg-red-500 text-white py-4 px-6 rounded-lg hover:bg-green-600 transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-lg font-semibold flex items-center justify-center gap-2">
                <img src="https://placehold.co/32x32/ffffff/000000?text=G" alt="Ícone de Galeria" class="w-8 h-8 object-contain">
                Função 1: Galeria de Fotos
            </button>
            <button id="function2Button" class="bg-red-500 text-white py-4 px-6 rounded-lg hover:bg-purple-600 transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-lg font-semibold flex items-center justify-center gap-2">
                <img src="https://placehold.co/32x32/ffffff/000000?text=C" alt="Ícone de Código" class="w-8 h-8 object-contain">
                Função 2: Copiar Código
            </button>
            <button id="function3Button" class="bg-red-500 text-white py-4 px-6 rounded-lg hover:bg-red-600 transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-lg font-semibold flex items-center justify-center gap-2">
                <img src="https://placehold.co/32x32/ffffff/000000?text=V" alt="Ícone de Vídeos" class="w-8 h-8 object-contain">
                Função 3: Galeria de Vídeos
            </button>
        </div>
        <button id="adminPanelButton" class="mt-6 bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition duration-300 ease-in-out transform hover:scale-105 shadow-md hidden">Painel de Admin</button>
        <button id="logoutButton" class="mt-10 bg-gray-300 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-400 transition duration-300 ease-in-out transform hover:scale-105 shadow-md">Sair</button>
    </div>

    <div id="photoGalleryModal" class="photo-gallery-modal hidden">
        <div class="photo-gallery-content">
            <button id="closeGalleryButton" class="photo-gallery-close">&times;</button>
            <h3 class="text-2xl font-bold mb-4 text-gray-800">Escolha uma Foto</h3>
            
            <div class="photo-search-container">
                <input type="number" id="photoSearchInput" placeholder="Buscar foto por número (1-230)" class="text-gray-800">
                <button id="searchPhotoButton">Buscar</button>
            </div>

            <div id="thumbnailsContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 w-full max-h-64 overflow-y-auto p-2 rounded-lg bg-gray-100">
                </div>
            <img id="mainPhotoDisplay" src="" alt="Foto Selecionada" class="main-photo-display hidden mx-auto rounded-lg shadow-lg">
            
            <div class="gallery-navigation flex justify-center items-center gap-4 mt-4 w-full">
                <button id="prevPhotoButton" class="py-2 px-4 rounded-lg">Anterior</button>
                <span id="photoCounter" class="text-gray-700 font-semibold"></span>
                <button id="nextPhotoButton" class="py-2 px-4 rounded-lg">Próximo</button>
            </div>
        </div>
    </div>

    <div id="codeModal" class="code-modal hidden">
        <div class="code-modal-content">
            <button id="closeCodeModalButton" class="code-modal-close">&times;</button>
            <h3 class="text-2xl font-bold mb-4 text-gray-800">Selecione um Código</h3>
            
            <select id="codeSelector" class="w-full p-2 border border-gray-300 rounded-lg mb-4 bg-gray-100 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </select>

            <textarea id="codeDisplay" readonly class="w-full"></textarea>
            <button id="copyCodeButton" class="py-2 px-4 rounded-lg">Copiar Código</button>
        </div>
    </div>

    <div id="videoGalleryModal" class="video-gallery-modal hidden">
        <div class="video-gallery-content">
            <button id="closeVideoGalleryButton" class="video-gallery-close">&times;</button>
            <h3 class="text-2xl font-bold mb-4 text-gray-800">Escolha um Vídeo</h3>

            <div class="video-search-container">
                <input type="number" id="videoSearchInput" placeholder="Buscar vídeo por número (1-14)" class="text-gray-800">
                <button id="searchVideoButton">Buscar</button>
            </div>

            <div id="videoThumbnailsContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 w-full max-h-64 overflow-y-auto p-2 rounded-lg bg-gray-100">
                </div>
            <video id="mainVideoDisplay" controls class="main-video-display hidden mx-auto rounded-lg shadow-lg"></video>
            
            <div class="gallery-navigation flex justify-center items-center gap-4 mt-4 w-full">
                <button id="prevVideoButton" class="py-2 px-4 rounded-lg">Anterior</button>
                <span id="videoCounter" class="text-gray-700 font-semibold"></span>
                <button id="nextVideoButton" class="py-2 px-4 rounded-lg">Próximo</button>
            </div>
        </div>
    </div>

    <div id="adminModal" class="admin-modal hidden">
        <div class="admin-modal-content w-full max-w-4xl">
            <button id="closeAdminModalButton" class="admin-modal-close">&times;</button>
            <h3 class="text-3xl font-bold mb-6 text-gray-800">Painel de Administração</h3>

            <div id="adminPanelDashboard">
                <div class="admin-section">
                    <h4>Monitoramento do Site</h4>
                    <p class="text-lg text-gray-700">Usuários Logados: <span id="loggedInUsersCount" class="font-bold text-blue-600">0</span></p>
                </div>

                <div class="admin-section">
                    <h4>Gerenciamento de Usuários</h4>
                    <div class="mb-4">
                        <input type="text" id="newUsername" placeholder="Novo Usuário (Email)">
                        <input type="password" id="newPassword" placeholder="Nova Senha">
                        <button id="createNewUserButton" class="create w-full">Criar Novo Usuário</button>
                    </div>
                    <h5 class="text-xl font-semibold mb-2 text-gray-700">Lista de Usuários</h5>
                    <div class="max-h-64 overflow-y-auto border rounded-lg">
                        <table class="min-w-full bg-white" id="userListTable">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>ID do Usuário</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="userListBody">
                                </tbody>
                        </table>
                    </div>
                </div>

                <div class="admin-section">
                    <h4>Personalização do Site</h4>
                    <div class="mb-4">
                        <label for="siteFont" class="block text-gray-700 text-sm font-bold mb-2">Fonte do Site:</label>
                        <input type="text" id="siteFont" placeholder="Ex: 'Inter', sans-serif">
                        <button id="applyFontButton" class="apply w-full">Aplicar Fonte</button>
                    </div>
                    <div class="mb-4">
                        <label for="siteBackground" class="block text-gray-700 text-sm font-bold mb-2">URL da Imagem de Fundo:</label>
                        <input type="text" id="siteBackground" placeholder="Ex: https://sua-imagem.com/bg.jpg">
                        <button id="applyBackgroundButton" class="apply w-full">Aplicar Fundo</button>
                    </div>
                    <div class="flex-row-center mb-4">
                        <label for="enableAnimation" class="text-gray-700 text-sm font-bold">Ativar Animação:</label>
                        <input type="checkbox" id="enableAnimation" class="form-checkbox h-5 w-5 text-blue-600 rounded">
                        <button id="toggleAnimationButton" class="toggle">Aplicar Animação</button>
                    </div>
                    <div class="flex-row-center">
                        <label for="maintenanceMode" class="text-gray-700 text-sm font-bold">Modo de Manutenção:</label>
                        <input type="checkbox" id="maintenanceMode" class="form-checkbox h-5 w-5 text-red-600 rounded">
                        <button id="toggleMaintenanceButton" class="toggle">Aplicar Modo</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variáveis globais para Firebase (acessíveis após o carregamento do script type="module")
        let firebaseApp, firebaseDb, firebaseAuth, initialAuthToken, currentAppId;
        let onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut;
        let doc, getDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, addDoc, getDocs, signInAnonymously;
        let signInWithCustomToken; 

        // Aguarda o carregamento do script Firebase para acessar as variáveis
        window.addEventListener('load', () => {
            firebaseApp = window.firebaseApp;
            firebaseDb = window.firebaseDb;
            firebaseAuth = window.firebaseAuth;
            initialAuthToken = window.initialAuthToken;
            currentAppId = window.currentAppId;
            onAuthStateChanged = window.onAuthStateChanged;
            signInWithEmailAndPassword = window.signInWithEmailAndPassword;
            createUserWithEmailAndPassword = window.createUserWithEmailAndPassword;
            signOut = window.signOut;
            doc = window.doc;
            getDoc = window.getDoc;
            setDoc = window.setDoc;
            updateDoc = window.updateDoc;
            deleteDoc = window.deleteDoc;
            onSnapshot = window.onSnapshot;
            collection = window.collection;
            query = window.query;
            where = window.where;
            addDoc = window.addDoc;
            getDocs = window.getDocs;
            signInAnonymously = window.signInAnonymously;
            signInWithCustomToken = window.signInWithCustomToken;

            // Inicia a autenticação e os listeners do Firebase
            initFirebaseAndApp();
        });

        // --- Variáveis de estado globais ---
        let currentUser = null;
        let isAdmin = false;
        let siteConfig = {}; // Para armazenar as configurações do site
        let loggedInUsersCount = 0;

        // ID do usuário administrador (será carregado dinamicamente do Firestore)
        let dynamicAdminUid = null;

        // Função para exibir mensagens personalizadas
        function showMessage(message, type = 'success') {
            const messageBox = document.getElementById('messageBox');
            messageBox.textContent = message;
            messageBox.className = 'message-box rounded-lg show'; // Reset classes and show
            if (type === 'error') {
                messageBox.classList.add('error');
            } else {
                messageBox.classList.remove('error');
            }

            // Esconde a mensagem após 3 segundos
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 3000);
        }

        // --- Gerenciamento de UI ---
        const loginPanel = document.getElementById('loginPanel');
        const dashboardPanel = document.getElementById('dashboardPanel');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginButton = document.getElementById('loginButton');
        const logoutButton = document.getElementById('logoutButton');
        const function1Button = document.getElementById('function1Button');
        const function2Button = document.getElementById('function2Button');
        const function3Button = document.getElementById('function3Button');
        const adminPanelButton = document.getElementById('adminPanelButton');
        const maintenanceOverlay = document.getElementById('maintenanceOverlay');

        // Referências para a galeria de fotos
        const photoGalleryModal = document.getElementById('photoGalleryModal');
        const closeGalleryButton = document.getElementById('closeGalleryButton');
        const thumbnailsContainer = document.getElementById('thumbnailsContainer');
        const mainPhotoDisplay = document.getElementById('mainPhotoDisplay');
        const prevPhotoButton = document.getElementById('prevPhotoButton');
        const nextPhotoButton = document.getElementById('nextPhotoButton');
        const photoCounter = document.getElementById('photoCounter');
        const photoSearchInput = document.getElementById('photoSearchInput');
        const searchPhotoButton = document.getElementById('searchPhotoButton');

        // Referências para o modal de código
        const codeModal = document.getElementById('codeModal');
        const closeCodeModalButton = document.getElementById('closeCodeModalButton');
        const codeSelector = document.getElementById('codeSelector');
        const codeDisplay = document.getElementById('codeDisplay');
        const copyCodeButton = document.getElementById('copyCodeButton');

        // Referências para a galeria de vídeos
        const videoGalleryModal = document.getElementById('videoGalleryModal');
        const closeVideoGalleryButton = document.getElementById('closeVideoGalleryButton');
        const videoThumbnailsContainer = document.getElementById('videoThumbnailsContainer');
        const mainVideoDisplay = document.getElementById('mainVideoDisplay');
        const prevVideoButton = document.getElementById('prevVideoButton');
        const nextVideoButton = document.getElementById('nextVideoButton');
        const videoCounter = document.getElementById('videoCounter');
        const videoSearchInput = document.getElementById('videoSearchInput');
        const searchVideoButton = document.getElementById('searchVideoButton');

        // Referências para o Painel de Administração
        const adminModal = document.getElementById('adminModal');
        const closeAdminModalButton = document.getElementById('closeAdminModalButton');
        const loggedInUsersCountSpan = document.getElementById('loggedInUsersCount');
        const newUsernameInput = document.getElementById('newUsername');
        const newPasswordInput = document.getElementById('newPassword');
        const createNewUserButton = document.getElementById('createNewUserButton');
        const userListBody = document.getElementById('userListBody');
        const siteFontInput = document.getElementById('siteFont');
        const siteBackgroundInput = document.getElementById('siteBackground');
        const enableAnimationCheckbox = document.getElementById('enableAnimation');
        const maintenanceModeCheckbox = document.getElementById('maintenanceMode');
        const applyFontButton = document.getElementById('applyFontButton');
        const applyBackgroundButton = document.getElementById('applyBackgroundButton');
        const toggleAnimationButton = document.getElementById('toggleAnimationButton');
        const toggleMaintenanceButton = document.getElementById('toggleMaintenanceButton');

        let currentPhotoIndex = 0;
        const totalPhotos = 230;
        let currentVideoIndex = 0;
        const totalVideos = 14;

        // Array de URLs de fotos (simuladas para 230 fotos)
        // Você deve substituir estas URLs pelas URLs reais das suas 230 fotos.
        const photoUrls = [];
        for (let i = 0; i < totalPhotos; i++) {
            const r = (i * 10) % 255;
            const g = (i * 20) % 255;
            const b = (i * 30) % 255;
            const hexColor = ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);

            photoUrls.push({
                thumb: `https://placehold.co/150x100/${hexColor}/FFFFFF?text=Foto+${i + 1}`,
                full: `https://placehold.co/800x600/${hexColor}/FFFFFF?text=Foto+${i + 1}+Grande`
            });
        }

        // Array de URLs de vídeos (simuladas para 14 vídeos)
        // ATENÇÃO: Substitua estas URLs por URLs de vídeos reais (MP4, WebM, Ogg)
        // Use vídeos pequenos e de teste para evitar problemas de carregamento
        const videoUrls = [];
        for (let i = 0; i < totalVideos; i++) {
            videoUrls.push({
                thumb: `https://placehold.co/150x100/33A0FF/FFFFFF?text=Video+${i + 1}`, // Imagem de miniatura para o vídeo
                full: `https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4` // Exemplo de URL de vídeo MP4
            });
        }

        // Os 12 códigos diferentes e específicos
        const specificCodes = [
            {
                name: "Código 1: Desbloqueio Básico",
                code: `
                    // Código para desbloqueio básico de funcionalidade.
                    // Versão 1.0
                    function initBasicUnlock() {
                        console.log("Desbloqueio básico iniciado.");
                        // Lógica de desbloqueio aqui
                    }
                    initBasicUnlock();
                `
            },
            {
                name: "Código 2: Ativação de Recurso Premium",
                code: `
                    // Código para ativar recursos premium.
                    // Este código é sensível a maiúsculas/minúsculas.
                    const premiumKey = "PREMIUM_ACCESS_XYZ";
                    if (user.hasLicense(premiumKey)) {
                        activatePremiumFeatures();
                    } else {
                        console.warn("Chave premium inválida.");
                    }
                `
            },
            {
                name: "Código 3: Configuração de Tema Escuro",
                code: `
                    // Código CSS para tema escuro.
                    // Cole isso no seu arquivo CSS ou em uma tag <style>.
                    body.dark-mode {
                        background-color: #1a202c;
                        color: #e2e8f0;
                    }
                    .card.dark-mode {
                        background-color: #2d3748;
                        border-color: #4a5568;
                    }
                `
            },
            {
                name: "Código 4: Script de Validação de Formulário",
                code: `
                    // Script JavaScript para validação de formulário.
                    function validateForm() {
                        const email = document.getElementById('email').value;
                        if (!email.includes('@')) {
                            alert("Por favor, insira um email válido.");
                            return false;
                        }
                        return true;
                    }
                `
            },
            {
                name: "Código 5: Integração com API Externa",
                code: `
                    // Exemplo de chamada a uma API externa.
                    async function fetchData() {
                        try {
                            const response = await fetch('https://api.example.com/data');
                            const data = await response.json();
                            console.log("Dados da API:", data);
                        } catch (error) {
                            console.error("Erro ao buscar dados:", error);
                        }
                    }
                    // fetchData();
                `
            },
            {
                name: "Código 6: Animação de Botão CSS",
                code: `
                    /* Animação de hover para botões */
                    .animated-button {
                        transition: all 0.3s ease;
                    }
                    .animated-button:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                    }
                `
            },
            {
                name: "Código 7: Função de Criptografia Simples",
                code: `
                    // Função JavaScript para criptografia/descriptografia simples (apenas para demonstração).
                    function simpleEncrypt(text) {
                        return btoa(text); // Base64 encode
                    }
                    function simpleDecrypt(encodedText) {
                        return atob(encodedText); // Base64 decode
                    }
                    // console.log(simpleEncrypt("Olá Mundo"));
                `
            },
            {
                name: "Código 8: Componente React Básico",
                code: `
                    // Exemplo de componente React funcional.
                    // Certifique-se de ter React e ReactDOM configurados.
                    function MyComponent() {
                        return (
                            <div>
                                <h1>Meu Componente React</h1>
                                <p>Este é um exemplo simples.</p>
                            </div>
                        );
                    }
                    // ReactDOM.render(<MyComponent />, document.getElementById('root'));
                `
            },
            {
                name: "Código 9: Consulta SQL de Exemplo",
                code: `
                    -- Exemplo de consulta SQL para selecionar usuários.
                    SELECT id, nome, email
                    FROM usuarios
                    WHERE status = 'ativo'
                    ORDER BY nome ASC;
                `
            },
            {
                name: "Código 10: Configuração de Notificações",
                code: `
                    // Script para solicitar permissão de notificações.
                    if ('Notification' in window) {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                new Notification('Bem-vindo!', { body: 'Notificações ativadas.' });
                            }
                        });
                    }
                `
            },
            {
                name: "Código 11: Trecho de Código Python",
                code: `
                    # Exemplo de função Python para calcular fatorial.
                    def factorial(n):
                        if n == 0:
                            return 1
                        else:
                            return n * factorial(n-1)

                    # print(factorial(5)) # Saída: 120
                `
            },
            {
                name: "Código 12: Snippet de Carregamento Assíncrono",
                code: `
                    // Carregamento assíncrono de script externo.
                    function loadScript(url, callback) {
                        const script = document.createElement('script');
                        script.src = url;
                        script.onload = callback;
                        document.head.appendChild(script);
                    }
                    // loadScript('https://example.com/external.js', () => {
                    //     console.log('Script externo carregado!');
                    // });
                `
            }
        ];

        // --- Funções da Galeria de Fotos ---
        function populateThumbnails() {
            thumbnailsContainer.innerHTML = '';
            photoUrls.forEach((photo, index) => {
                const img = document.createElement('img');
                img.src = photo.thumb;
                img.alt = `Foto ${index + 1}`;
                img.classList.add('photo-thumbnail', 'w-full', 'h-auto', 'rounded-lg', 'shadow-md');
                img.dataset.index = index;
                thumbnailsContainer.appendChild(img);
            });
        }

        function displayPhoto(index) {
            if (index >= 0 && index < totalPhotos) {
                currentPhotoIndex = index;
                mainPhotoDisplay.src = photoUrls[currentPhotoIndex].full;
                mainPhotoDisplay.classList.remove('hidden');
                photoCounter.textContent = `${currentPhotoIndex + 1}/${totalPhotos}`;
            } else {
                showMessage('Número da foto fora do intervalo válido.', 'error');
            }
        }

        // --- Funções do Modal de Código ---
        function populateCodeSelector() {
            codeSelector.innerHTML = '';
            specificCodes.forEach((item, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = item.name;
                codeSelector.appendChild(option);
            });
            if (specificCodes.length > 0) {
                codeDisplay.value = specificCodes[0].code.trim();
            }
        }

        // --- Funções da Galeria de Vídeos ---
        function populateVideoThumbnails() {
            videoThumbnailsContainer.innerHTML = '';
            videoUrls.forEach((video, index) => {
                const img = document.createElement('img');
                img.src = video.thumb;
                img.alt = `Vídeo ${index + 1}`;
                img.classList.add('video-thumbnail', 'w-full', 'h-auto', 'rounded-lg', 'shadow-md');
                img.dataset.index = index;
                videoThumbnailsContainer.appendChild(img);
            });
        }

        function displayVideo(index) {
            if (index >= 0 && index < totalVideos) {
                currentVideoIndex = index;
                mainVideoDisplay.src = videoUrls[currentVideoIndex].full;
                mainVideoDisplay.classList.remove('hidden');
                mainVideoDisplay.load();
                mainVideoDisplay.play();
                videoCounter.textContent = `${currentVideoIndex + 1}/${totalVideos}`;
            } else {
                showMessage('Número do vídeo fora do intervalo válido.', 'error');
            }
        }

        // --- Funções do Firebase e Admin Panel ---
        async function initFirebaseAndApp() {
            // O listener onAuthStateChanged vai lidar com a exibição do painel de login se nenhum usuário for encontrado.

            // Listener de estado de autenticação
            onAuthStateChanged(firebaseAuth, async (user) => {
                currentUser = user;
                if (user) {
                    console.log("Usuário logado:", user.uid);

                    // Carrega site config primeiro para obter dynamicAdminUid
                    await loadSiteConfig(); // Isso vai atualizar siteConfig global e dynamicAdminUid

                    // Se este for o email admin e o dynamicAdminUid ainda não estiver setado no Firestore, salve-o.
                    if (user.email === 'admin123@admin.com' && dynamicAdminUid !== user.uid) {
                        await updateDoc(doc(firebaseDb, `artifacts/${currentAppId}/public/data/site_config`, 'main'), { adminUid: user.uid });
                        dynamicAdminUid = user.uid; // Atualiza a variável local imediatamente
                        console.warn(`*** AÇÃO NECESSÁRIA: O UID de administrador foi definido no Firestore como: ${user.uid}. Por favor, atualize as regras do Firestore para permitir acesso de escrita a este UID! ***`);
                        showMessage('UID de administrador salvo. Lembre-se de atualizar as regras do Firestore!', 'warning');
                    }

                    isAdmin = (user.uid === dynamicAdminUid); // Agora usa o UID carregado dinamicamente
                    adminPanelButton.classList.toggle('hidden', !isAdmin);

                    // Adiciona/Atualiza presença do usuário logado
                    const loggedInUserRef = doc(firebaseDb, `artifacts/${currentAppId}/public/data/logged_in_users`, user.uid);
                    await setDoc(loggedInUserRef, { lastSeen: new Date().getTime() }, { merge: true });

                    // Listener para remover presença ao fechar/navegar
                    window.addEventListener('beforeunload', async () => {
                        if (currentUser) {
                            await deleteDoc(doc(firebaseDb, `artifacts/${currentAppId}/public/data/logged_in_users`, currentUser.uid));
                            console.log("Presença do usuário removida.");
                        }
                    });

                    // Determina qual painel mostrar
                    if (siteConfig.maintenanceMode) {
                        maintenanceOverlay.classList.remove('hidden');
                        loginPanel.classList.add('hidden');
                        dashboardPanel.classList.add('hidden');
                        adminModal.classList.add('hidden');
                    } else if (isAdmin) {
                        setupAdminListeners();
                        listenToUsers();
                        listenToLoggedInUsers();
                        loginPanel.classList.add('hidden');
                        dashboardPanel.classList.add('hidden');
                        adminModal.classList.remove('hidden');
                    } else {
                        loginPanel.classList.add('hidden');
                        dashboardPanel.classList.remove('hidden');
                        adminModal.classList.add('hidden');
                    }
                } else {
                    console.log("Nenhum usuário logado. Mostrando painel de login.");
                    isAdmin = false;
                    adminPanelButton.classList.add('hidden');
                    dashboardPanel.classList.add('hidden');
                    adminModal.classList.add('hidden');
                    loginPanel.classList.remove('hidden');
                    // Garante que o overlay de manutenção esteja oculto se nenhum usuário estiver logado
                    maintenanceOverlay.classList.add('hidden');
                }
            });

            // Listener para configurações do site (para todos os usuários)
            onSnapshot(doc(firebaseDb, `artifacts/${currentAppId}/public/data/site_config`, 'main'), (docSnap) => {
                if (docSnap.exists()) {
                    siteConfig = docSnap.data();
                    dynamicAdminUid = siteConfig.adminUid || null; // Atualiza dynamicAdminUid global
                    applySiteConfig();
                    // Re-avalia o estado da UI após a mudança de configuração
                    if (siteConfig.maintenanceMode) {
                        maintenanceOverlay.classList.remove('hidden');
                        loginPanel.classList.add('hidden');
                        dashboardPanel.classList.add('hidden');
                        adminModal.classList.add('hidden');
                    } else {
                        maintenanceOverlay.classList.add('hidden');
                        if (currentUser) {
                            isAdmin = (currentUser.uid === dynamicAdminUid); // Re-verifica isAdmin
                            adminPanelButton.classList.toggle('hidden', !isAdmin);
                            if (isAdmin) {
                                adminModal.classList.remove('hidden');
                                dashboardPanel.classList.add('hidden');
                                loginPanel.classList.add('hidden');
                            } else {
                                dashboardPanel.classList.remove('hidden');
                                loginPanel.classList.add('hidden');
                                adminModal.classList.add('hidden');
                            }
                        } else {
                            loginPanel.classList.remove('hidden');
                            dashboardPanel.classList.add('hidden');
                            adminModal.classList.add('hidden');
                        }
                    }
                } else {
                    console.log("Configuração do site não encontrada. Criando padrão...");
                    setDoc(doc(firebaseDb, `artifacts/${currentAppId}/public/data/site_config`, 'main'), {
                        themeFont: 'Inter, sans-serif',
                        backgroundImage: 'https://backiee.com/static/wallpapers/560x315/411581.jpg',
                        enableAnimation: false,
                        maintenanceMode: false,
                        adminUid: null // Inicializa adminUid como null
                    });
                }
            });
        }

        async function loadSiteConfig() {
            const configRef = doc(firebaseDb, `artifacts/${currentAppId}/public/data/site_config`, 'main');
            const docSnap = await getDoc(configRef);
            if (docSnap.exists()) {
                siteConfig = docSnap.data();
                dynamicAdminUid = siteConfig.adminUid || null; // Atualiza dynamicAdminUid global
            } else {
                // Configurações padrão se não existirem
                siteConfig = {
                    themeFont: 'Inter, sans-serif',
                    backgroundImage: 'https://backiee.com/static/wallpapers/560x315/411581.jpg',
                    enableAnimation: false,
                    maintenanceMode: false,
                    adminUid: null
                };
                await setDoc(configRef, siteConfig);
            }
            // Atualiza os inputs do painel de administração com os valores carregados
            siteFontInput.value = siteConfig.themeFont || '';
            siteBackgroundInput.value = siteConfig.backgroundImage || '';
            enableAnimationCheckbox.checked = siteConfig.enableAnimation || false;
            maintenanceModeCheckbox.checked = siteConfig.maintenanceMode || false;

            // Se estiver em modo de manutenção, exibe o overlay
            if (siteConfig.maintenanceMode) {
                maintenanceOverlay.classList.remove('hidden');
                loginPanel.classList.add('hidden');
                dashboardPanel.classList.add('hidden');
            } else {
                maintenanceOverlay.classList.add('hidden');
            }
        }

        function applySiteConfig() {
            document.body.style.fontFamily = siteConfig.themeFont;
            document.body.style.backgroundImage = `url('${siteConfig.backgroundImage}')`;
            // Lógica para animação (exemplo simples: adicionar/remover uma classe)
            if (siteConfig.enableAnimation) {
                document.body.classList.add('animated-background'); // Adicione esta classe no CSS se quiser uma animação
            } else {
                document.body.classList.remove('animated-background');
            }
        }

        async function updateSiteConfig(updates) {
            if (!isAdmin) {
                showMessage("Apenas administradores podem modificar as configurações do site.", "error");
                return;
            }
            const configRef = doc(firebaseDb, `artifacts/${currentAppId}/public/data/site_config`, 'main');
            try {
                await updateDoc(configRef, updates);
                showMessage("Configurações do site atualizadas!", "success");
            } catch (error) {
                console.error("Erro ao atualizar configurações do site:", error);
                showMessage("Erro ao atualizar configurações do site.", "error");
            }
        }

        // --- Gerenciamento de Usuários (Admin) ---
        async function createUser(email, password) {
            if (!isAdmin) {
                showMessage("Apenas administradores podem criar usuários.", "error");
                return;
            }
            try {
                const userCredential = await createUserWithEmailAndPassword(firebaseAuth, email, password);
                const user = userCredential.user;
                // Salva informações adicionais no Firestore
                await setDoc(doc(firebaseDb, `artifacts/${currentAppId}/public/data/users`, user.uid), {
                    email: user.email,
                    isBlacklisted: false,
                    isAdmin: false, // Novos usuários não são admin por padrão
                    createdAt: new Date().getTime()
                });
                showMessage(`Usuário ${email} criado com sucesso!`, "success");
                newUsernameInput.value = '';
                newPasswordInput.value = '';
            } catch (error) {
                console.error("Erro ao criar usuário:", error);
                showMessage(`Erro ao criar usuário: ${error.message}`, "error");
            }
        }

        async function toggleBlacklistUser(uid, isBlacklisted) {
            if (!isAdmin) {
                showMessage("Apenas administradores podem gerenciar usuários.", "error");
                return;
            }
            // Não permite bloquear o próprio admin
            if (uid === dynamicAdminUid) {
                showMessage("Não é possível bloquear a conta de administrador principal.", "error");
                return;
            }
            try {
                await updateDoc(doc(firebaseDb, `artifacts/${currentAppId}/public/data/users`, uid), {
                    isBlacklisted: isBlacklisted
                });
                showMessage(`Usuário ${uid} ${isBlacklisted ? 'adicionado à lista negra' : 'removido da lista negra'}.`, "success");
            } catch (error) {
                console.error("Erro ao atualizar status do usuário:", error);
                showMessage("Erro ao atualizar status do usuário.", "error");
            }
        }

        async function deleteUserFromFirestore(uid, email) {
             if (!isAdmin) {
                showMessage("Apenas administradores podem remover usuários.", "error");
                return;
            }
            // Não permite remover o próprio admin
            if (uid === dynamicAdminUid) {
                showMessage("Não é possível remover a conta de administrador principal.", "error");
                return;
            }
            // OBS: Deletar usuário do Firebase Authentication diretamente do cliente não é seguro/simples.
            // Em uma aplicação real, isso seria feito por uma função de backend (Cloud Function).
            // Aqui, estamos apenas removendo o registro do Firestore e desativando o login.
            try {
                await deleteDoc(doc(firebaseDb, `artifacts/${currentAppId}/public/data/users`, uid));
                // Opcional: Se você quiser desativar o login via Firebase Auth, precisaria de uma Cloud Function.
                // Por enquanto, a lista negra do Firestore já impede o login.
                showMessage(`Usuário ${email} removido com sucesso (Firestore).`, "success");
            } catch (error) {
                console.error("Erro ao remover usuário do Firestore:", error);
                showMessage("Erro ao remover usuário.", "error");
            }
        }


        function listenToUsers() {
            onSnapshot(collection(firebaseDb, `artifacts/${currentAppId}/public/data/users`), (snapshot) => {
                userListBody.innerHTML = ''; // Limpa a lista
                snapshot.forEach((doc) => {
                    const userData = doc.data();
                    const uid = doc.id;
                    const row = userListBody.insertRow();
                    row.insertCell(0).textContent = userData.email || 'N/A';
                    row.insertCell(1).textContent = uid;
                    row.insertCell(2).textContent = userData.isBlacklisted ? 'Bloqueado' : 'Ativo';

                    const actionsCell = row.insertCell(3);
                    // Não mostra botões de ação para o próprio admin
                    if (uid !== dynamicAdminUid) {
                        const blacklistButton = document.createElement('button');
                        if (userData.isBlacklisted) {
                            blacklistButton.textContent = 'Desbloquear';
                            blacklistButton.classList.add('unblacklist');
                        } else {
                            blacklistButton.textContent = 'Bloquear';
                            blacklistButton.classList.add('blacklist');
                        }
                        blacklistButton.onclick = () => toggleBlacklistUser(uid, !userData.isBlacklisted);
                        actionsCell.appendChild(blacklistButton);

                        const removeButton = document.createElement('button');
                        removeButton.textContent = 'Remover';
                        removeButton.classList.add('remove', 'ml-2');
                        removeButton.onclick = () => {
                            if (confirm(`Tem certeza que deseja remover o usuário ${userData.email}?`)) {
                                deleteUserFromFirestore(uid, userData.email);
                            }
                        };
                        actionsCell.appendChild(removeButton);
                    } else {
                        actionsCell.textContent = 'Admin';
                    }
                });
            });
        }

        function listenToLoggedInUsers() {
            onSnapshot(collection(firebaseDb, `artifacts/${currentAppId}/public/data/logged_in_users`), (snapshot) => {
                loggedInUsersCount = snapshot.size;
                loggedInUsersCountSpan.textContent = loggedInUsersCount;
            });
        }

        function setupAdminListeners() {
            createNewUserButton.addEventListener('click', () => {
                const email = newUsernameInput.value;
                const password = newPasswordInput.value;
                if (email && password) {
                    createUser(email, password);
                } else {
                    showMessage("Por favor, preencha email e senha para o novo usuário.", "error");
                }
            });

            applyFontButton.addEventListener('click', () => {
                updateSiteConfig({ themeFont: siteFontInput.value });
            });

            applyBackgroundButton.addEventListener('click', () => {
                updateSiteConfig({ backgroundImage: siteBackgroundInput.value });
            });

            toggleAnimationButton.addEventListener('click', () => {
                updateSiteConfig({ enableAnimation: enableAnimationCheckbox.checked });
            });

            toggleMaintenanceButton.addEventListener('click', () => {
                updateSiteConfig({ maintenanceMode: maintenanceModeCheckbox.checked });
            });
        }

        // --- Event Listeners Existentes ---
        loginButton.addEventListener('click', async () => {
            const email = usernameInput.value;
            const password = passwordInput.value;

            // Lógica de login do Administrador
            if (email === 'admin123@admin.com' && password === 'admin1234') {
                try {
                    let userCredential;
                    try {
                        userCredential = await signInWithEmailAndPassword(firebaseAuth, email, password);
                    } catch (loginError) {
                        if (loginError.code === 'auth/user-not-found') {
                            // Se o usuário admin não existe, tenta criá-lo
                            userCredential = await createUserWithEmailAndPassword(firebaseAuth, email, password);
                            showMessage('Conta de administrador criada e logada com sucesso!', 'success');
                        } else {
                            throw loginError; // Re-lança outros erros de login
                        }
                    }
                    const user = userCredential.user;

                    // Garante que o usuário admin esteja registrado no Firestore com a flag isAdmin
                    const adminUserRef = doc(firebaseDb, `artifacts/${currentAppId}/public/data/users`, user.uid);
                    await setDoc(adminUserRef, {
                        email: user.email,
                        isBlacklisted: false,
                        isAdmin: true, // Marca explicitamente como admin no Firestore
                        createdAt: new Date().getTime()
                    }, { merge: true });

                    // Define o dynamicAdminUid no Firestore se ainda não estiver setado para este UID
                    if (siteConfig.adminUid !== user.uid) {
                        await updateDoc(doc(firebaseDb, `artifacts/${currentAppId}/public/data/site_config`, 'main'), { adminUid: user.uid });
                        dynamicAdminUid = user.uid; // Atualiza a variável local
                        console.warn(`*** AÇÃO NECESSÁRIA: O UID de administrador foi definido no Firestore como: ${user.uid}. Por favor, atualize as regras do Firestore para permitir acesso de escrita a este UID! ***`);
                        showMessage('UID de administrador salvo no Firestore. Lembre-se de atualizar as regras do Firestore!', 'warning');
                    }

                    // A atualização da UI será tratada pelo listener onAuthStateChanged
                    showMessage('Login de administrador realizado com sucesso!', 'success');
                    return; // Sai da função após o login do admin
                } catch (error) {
                    console.error("Erro no login/criação de administrador:", error);
                    let errorMessage = "Erro no login de administrador. Verifique as credenciais.";
                    if (error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                        errorMessage = "Senha do administrador inválida.";
                    } else if (error.code === 'auth/email-already-in-use') {
                        errorMessage = "Email de administrador já em uso, mas senha incorreta.";
                    }
                    showMessage(errorMessage, "error");
                    return;
                }
            }

            // Lógica de Login para Usuários Normais (não-admin)
            try {
                const userCredential = await signInWithEmailAndPassword(firebaseAuth, email, password);
                const user = userCredential.user;

                // 2. Verifica se o usuário está na lista negra do Firestore
                const userDocRef = doc(firebaseDb, `artifacts/${currentAppId}/public/data/users`, user.uid);
                const userDocSnap = await getDoc(userDocRef);

                if (userDocSnap.exists() && userDocSnap.data().isBlacklisted) {
                    await signOut(firebaseAuth); // Desloga o usuário se estiver na lista negra
                    showMessage('Acesso negado. Sua conta está bloqueada.', 'error');
                    return;
                }

                // Se o usuário não existe no Firestore (ex: novo usuário criado via Firebase Auth diretamente), cria um registro básico
                if (!userDocSnap.exists()) {
                    await setDoc(userDocRef, {
                        email: user.email,
                        isBlacklisted: false,
                        isAdmin: false, // Novos usuários não são admin por padrão
                        createdAt: new Date().getTime()
                    });
                }

                // 3. Verifica o sistema de IP fixo (mantido do seu código original)
                // OBS: O rastreamento de IP fixo via localStorage é cliente-side e pode ser burlado.
                // Para maior segurança, isso deveria ser feito no backend.
                const USERS_TO_TRACK_IP = ['ana@example.com', 'lara@example.com']; // Use emails para consistência
                const shouldTrackIp = USERS_TO_TRACK_IP.includes(email);

                if (shouldTrackIp) {
                    const currentIp = await getClientIp();
                    if (!currentIp) {
                        showMessage('Não foi possível verificar seu IP. Tente novamente.', 'error');
                        await signOut(firebaseAuth);
                        return;
                    }
                    const storedIp = localStorage.getItem(`userIp_${user.uid}`); // Usa UID para armazenar IP
                    if (storedIp && storedIp !== currentIp) {
                        showMessage('Acesso negado. Login permitido apenas do IP registrado para esta conta.', 'error');
                        await signOut(firebaseAuth);
                        return;
                    } else if (!storedIp) {
                        localStorage.setItem(`userIp_${user.uid}`, currentIp);
                        showMessage(`IP (${currentIp}) registrado para ${email}.`, 'success');
                    }
                }

                // Se passou por todas as verificações, mostra o dashboard
                loginPanel.classList.add('hidden');
                dashboardPanel.classList.remove('hidden');
                showMessage('Login realizado com sucesso!', 'success');

            } catch (error) {
                console.error("Erro de login:", error);
                let errorMessage = "Erro de login. Verifique seu usuário e senha.";
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                    errorMessage = "Usuário ou senha inválidos.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Formato de email inválido.";
                }
                showMessage(errorMessage, "error");
            }
        });

        logoutButton.addEventListener('click', async () => {
            try {
                if (currentUser) {
                    // Remove presença do usuário logado no Firestore
                    await deleteDoc(doc(firebaseDb, `artifacts/${currentAppId}/public/data/logged_in_users`, currentUser.uid));
                    console.log("Presença do usuário removida ao fazer logout.");
                }
                await signOut(firebaseAuth);
                dashboardPanel.classList.add('hidden');
                loginPanel.classList.remove('hidden');
                adminModal.classList.add('hidden'); // Garante que o painel admin também seja ocultado
                usernameInput.value = '';
                passwordInput.value = '';
                showMessage('Você saiu da sua conta.', 'success');
            } catch (error) {
                console.error("Erro ao fazer logout:", error);
                showMessage("Erro ao fazer logout.", "error");
            }
        });

        adminPanelButton.addEventListener('click', () => {
            if (isAdmin) {
                adminModal.classList.remove('hidden');
                dashboardPanel.classList.add('hidden'); // Esconde o dashboard normal ao abrir o admin
            } else {
                showMessage("Você não tem permissão para acessar o painel de administração.", "error");
            }
        });

        closeAdminModalButton.addEventListener('click', () => {
            adminModal.classList.add('hidden');
            // Ao fechar o painel admin, decide se mostra o dashboard normal ou o login
            if (currentUser && !siteConfig.maintenanceMode) {
                dashboardPanel.classList.remove('hidden');
            } else if (!currentUser) {
                loginPanel.classList.remove('hidden');
            }
        });

        function1Button.addEventListener('click', () => {
            photoGalleryModal.classList.remove('hidden');
            populateThumbnails();
            displayPhoto(0);
        });

        closeGalleryButton.addEventListener('click', () => {
            photoGalleryModal.classList.add('hidden');
        });

        thumbnailsContainer.addEventListener('click', (event) => {
            if (event.target.classList.contains('photo-thumbnail')) {
                const index = parseInt(event.target.dataset.index);
                displayPhoto(index);
                showMessage('Foto carregada com sucesso!', 'success');
            }
        });

        prevPhotoButton.addEventListener('click', () => {
            displayPhoto(currentPhotoIndex - 1);
        });

        nextPhotoButton.addEventListener('click', () => {
            displayPhoto(currentPhotoIndex + 1);
        });

        searchPhotoButton.addEventListener('click', () => {
            const photoNumber = parseInt(photoSearchInput.value);
            if (!isNaN(photoNumber) && photoNumber >= 1 && photoNumber <= totalPhotos) {
                displayPhoto(photoNumber - 1);
                showMessage(`Foto ${photoNumber} encontrada!`, 'success');
            } else {
                showMessage('Número da foto inválido. Por favor, digite um número entre 1 e ' + totalPhotos + '.', 'error');
            }
        });

        photoSearchInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                searchPhotoButton.click();
            }
        });

        function2Button.addEventListener('click', () => {
            populateCodeSelector();
            codeModal.classList.remove('hidden');
        });

        codeSelector.addEventListener('change', () => {
            const selectedIndex = parseInt(codeSelector.value);
            codeDisplay.value = specificCodes[selectedIndex].code.trim();
        });

        closeCodeModalButton.addEventListener('click', () => {
            codeModal.classList.add('hidden');
        });

        copyCodeButton.addEventListener('click', () => {
            codeDisplay.select();
            codeDisplay.setSelectionRange(0, 99999);
            try {
                document.execCommand('copy');
                showMessage('Código copiado para a área de transferência!', 'success');
            } catch (err) {
                showMessage('Erro ao copiar o código. Por favor, copie manualmente.', 'error');
                console.error('Falha ao copiar:', err);
            }
        });

        function3Button.addEventListener('click', () => {
            populateVideoThumbnails();
            videoGalleryModal.classList.remove('hidden');
            displayVideo(0);
        });

        closeVideoGalleryButton.addEventListener('click', () => {
            mainVideoDisplay.pause();
            videoGalleryModal.classList.add('hidden');
        });

        videoThumbnailsContainer.addEventListener('click', (event) => {
            if (event.target.classList.contains('video-thumbnail')) {
                const index = parseInt(event.target.dataset.index);
                displayVideo(index);
                showMessage('Vídeo carregado com sucesso!', 'success');
            }
        });

        prevVideoButton.addEventListener('click', () => {
            displayVideo(currentVideoIndex - 1);
        });

        nextVideoButton.addEventListener('click', () => {
            displayVideo(currentVideoIndex + 1);
        });

        searchVideoButton.addEventListener('click', () => {
            const videoNumber = parseInt(videoSearchInput.value);
            if (!isNaN(videoNumber) && videoNumber >= 1 && videoNumber <= totalVideos) {
                displayVideo(videoNumber - 1);
                showMessage(`Vídeo ${videoNumber} encontrado!`, 'success');
            } else {
                showMessage('Número do vídeo inválido. Por favor, digite um número entre 1 e ' + totalVideos + '.', 'error');
            }
        });

        videoSearchInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                searchVideoButton.click();
            }
        });

        // Função para obter o IP do cliente (mantida do seu código original)
        async function getClientIp() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                if (!response.ok) {
                    console.error("Erro na requisição ao ipify.org:", response.statusText);
                    return null;
                }
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error("Erro ao obter o IP:", error);
                return null;
            }
        }
    </script>
</body>
</html>
